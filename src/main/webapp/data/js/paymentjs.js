!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var n;n="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,n.paymentjs=e()}}(function(){return function e(n,t,r){function a(i,c){if(!t[i]){if(!n[i]){var u="function"==typeof require&&require;if(!c&&u)return u(i,!0);if(o)return o(i,!0);var s=new Error("Cannot find module '"+i+"'");throw s.code="MODULE_NOT_FOUND",s}var l=t[i]={exports:{}};n[i][0].call(l.exports,function(e){var t=n[i][1][e];return a(t?t:e)},l,l.exports,e,n,t,r)}return t[i].exports}for(var o="function"==typeof require&&require,i=0;i<r.length;i++)a(r[i]);return a}({1:[function(e,n,t){n.exports={userCallback:void 0,innerCallback:function(e,n){'function'==typeof this.userCallback&&('undefined'==typeof n&&(n=this.error()),this.userCallback(e,n),this.userCallback=void 0)},error:function(e,n){return e='undefined'==typeof e?'':e,n='undefined'==typeof n?'':n,{msg:e,extra:n}}}},{}],2:[function(e,n,t){var r={}.hasOwnProperty,a={};n.exports=a,a.channels={sand_h5:e('./channel/sand_h5'),sand_pc:e('./channel/sand_pc'),wx_pub:e('./channel/wx_pub'),ali_pub:e('./channel/ali_pub'),bank_pc:e('./channel/bank_pc')},a.extras={ap:e('./channel/extras/ap')},a.getChannelModule=function(e){if(r.call(a.channels,e))return a.channels[e]},a.getExtraModule=function(e){if(r.call(a.extras,e))return a.extras[e]}},{"./channel/ali_pub":3,"./channel/bank_pc":4,"./channel/extras/ap":5,"./channel/sand_h5":6,"./channel/sand_pc":7,"./channel/wx_pub":8}],3:[function(e,n,t){var r=e('../callbacks'),a=(e('../utils'),e('../stash')),o=(e('../channelMod'),{}.hasOwnProperty);n.exports={handleCharge:function(e){var n=e.params;a.jsApiParameters=n,this.aliAPICall()},aliAPICall:function(){o.call(a,'jsApiParameters')&&AlipayJSBridge.call("tradePay",{tradeNO:a.jsApiParameters.tradeNO},function(e){r.innerCallback(e)})}}},{"../callbacks":1,"../channelMod":2,"../stash":10,"../utils":11}],4:[function(e,n,t){var r=e('../utils');({}).hasOwnProperty;n.exports={handleCharge:function(e){var n=e.params,t=e.submitUrl;r.formSubmitNew(t,'post',n)}}},{"../utils":11}],5:[function(e,n,t){var r=e('../../stash'),a={}.hasOwnProperty;!function(){var e={},t={};t.PADCHAR='=',t.ALPHA='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/',t.makeDOMException=function(){try{return new DOMException(DOMException.INVALID_CHARACTER_ERR)}catch(n){var e=new Error('DOM Exception 5');return e.code=e.number=5,e.name=e.description='INVALID_CHARACTER_ERR',e.toString=function(){return'Error: '+e.name+': '+e.message},e}},t.getbyte64=function(e,n){var r=t.ALPHA.indexOf(e.charAt(n));if(r===-1)throw t.makeDOMException();return r},t.decode=function(e){e=''+e;var n,r,a,o=t.getbyte64,i=e.length;if(0===i)return e;if(i%4!==0)throw t.makeDOMException();n=0,e.charAt(i-1)===t.PADCHAR&&(n=1,e.charAt(i-2)===t.PADCHAR&&(n=2),i-=4);var c=[];for(r=0;r<i;r+=4)a=o(e,r)<<18|o(e,r+1)<<12|o(e,r+2)<<6|o(e,r+3),c.push(String.fromCharCode(a>>16,a>>8&255,255&a));switch(n){case 1:a=o(e,r)<<18|o(e,r+1)<<12|o(e,r+2)<<6,c.push(String.fromCharCode(a>>16,a>>8&255));break;case 2:a=o(e,r)<<18|o(e,r+1)<<12,c.push(String.fromCharCode(a>>16))}return c.join('')},t.getbyte=function(e,n){var r=e.charCodeAt(n);if(r>255)throw t.makeDOMException();return r},t.encode=function(e){if(1!==arguments.length)throw new SyntaxError('Not enough arguments');var n,r,a=t.PADCHAR,o=t.ALPHA,i=t.getbyte,c=[];e=''+e;var u=e.length-e.length%3;if(0===e.length)return e;for(n=0;n<u;n+=3)r=i(e,n)<<16|i(e,n+1)<<8|i(e,n+2),c.push(o.charAt(r>>18)),c.push(o.charAt(r>>12&63)),c.push(o.charAt(r>>6&63)),c.push(o.charAt(63&r));switch(e.length-u){case 1:r=i(e,n)<<16,c.push(o.charAt(r>>18)+o.charAt(r>>12&63)+a+a);break;case 2:r=i(e,n)<<16|i(e,n+1)<<8,c.push(o.charAt(r>>18)+o.charAt(r>>12&63)+o.charAt(r>>6&63)+a)}return c.join('')},e.url='pay.htm',e.pay=function(n){var o=encodeURIComponent(t.encode(n));a.call(r,'APURL')&&(e.url=r.APURL),location.href=e.url+'?goto='+o},e.decode=function(e){return t.decode(decodeURIComponent(e))},n.exports=e}()},{"../../stash":10}],6:[function(e,n,t){var r=e('../utils');({}).hasOwnProperty;n.exports={handleCharge:function(e){var n=e.params,t=e.submitUrl;r.redirectTo(t+'?params='+n)}}},{"../utils":11}],7:[function(e,n,t){var r=e('../utils');({}).hasOwnProperty;n.exports={handleCharge:function(e){var n=e.params,t=e.submitUrl;r.formSubmit(t,'post',n)}}},{"../utils":11}],8:[function(e,n,t){var r=e('../callbacks'),a=(e('../utils'),e('../stash')),o=e('../channelMod'),i={}.hasOwnProperty;n.exports={handleCharge:function(e){for(var n=e.params,t=['appId','timeStamp','nonceStr','package','signType','paySign'],o=0;o<t.length;o++)if(!i.call(n,t[o]))return void r.innerCallback('fail',r.error('invalid_credential','missing_field_'+t[o]));a.jsApiParameters=n,this.callpay()},callpay:function(){var e=this,n=o.getExtraModule('wx_jssdk');if('undefined'!=typeof n&&n.jssdkEnabled())n.callpay();else if('undefined'==typeof WeixinJSBridge){var t=function(){e.jsApiCall()};document.addEventListener?document.addEventListener('WeixinJSBridgeReady',t,!1):document.attachEvent&&(document.attachEvent('WeixinJSBridgeReady',t),document.attachEvent('onWeixinJSBridgeReady',t))}else this.jsApiCall()},jsApiCall:function(){i.call(a,'jsApiParameters')&&WeixinJSBridge.invoke('getBrandWCPayRequest',a.jsApiParameters,function(e){delete a.jsApiParameters,'get_brand_wcpay_request:ok'==e.err_msg?r.innerCallback('success'):'get_brand_wcpay_request:cancel'==e.err_msg?r.innerCallback('cancel'):r.innerCallback('fail',r.error('wx_result_fail',e.err_msg))})}}},{"../callbacks":1,"../channelMod":2,"../stash":10,"../utils":11}],9:[function(e,n,t){var r=e('./callbacks'),a=e('./channelMod'),o={}.hasOwnProperty,PaymentSDK=function(){};PaymentSDK.prototype={createPayment:function(e,n){'function'==typeof n&&(r.userCallback=n);var t;if('string'==typeof e)try{t=JSON.parse(e)}catch(e){return void r.innerCallback('fail',r.error('json_decode_fail',e))}else t=e;if('undefined'==typeof t)return void r.innerCallback('fail',r.error('json_decode_fail'));var i=t.payMode;if(!o.call(t,'params'))return void r.innerCallback('fail',r.error('invalid_charge','no_params'));var c=a.getChannelModule(i);c.handleCharge(t)}},n.exports=new PaymentSDK},{"./callbacks":1,"./channelMod":2}],10:[function(e,n,t){n.exports={}},{}],11:[function(e,n,t){var r={}.hasOwnProperty,a=n.exports={stringifyData:function(e,n,t){'undefined'==typeof t&&(t=!1);var a=[];for(var o in e)r.call(e,o)&&'function'!=typeof e[o]&&('bfb_wap'==n&&'url'==o||'yeepay_wap'==n&&'mode'==o||'channel_url'!=o&&a.push(o+'='+(t?encodeURIComponent(e[o]):e[o])));return a.join('&')},request:function(e,n,t,o,i,c){if('undefined'==typeof XMLHttpRequest)return void console.log('Function XMLHttpRequest is undefined.');var u=new XMLHttpRequest;if('undefined'!=typeof u.timeout&&(u.timeout=6e3),n=n.toUpperCase(),'GET'===n&&'object'==typeof t&&t&&(e+='?'+a.stringifyData(t,'',!0)),u.open(n,e,!0),'undefined'!=typeof c)for(var s in c)r.call(c,s)&&u.setRequestHeader(s,c[s]);'POST'===n?(u.setRequestHeader('Content-type','application/json; charset=utf-8'),u.send(JSON.stringify(t))):u.send(),'undefined'==typeof o&&(o=function(){}),'undefined'==typeof i&&(i=function(){}),u.onreadystatechange=function(){4==u.readyState&&o(u.responseText,u.status,u)},u.onerror=function(e){i(u,0,e)}},formSubmitNew:function(e,n,t){if('undefined'==typeof window)return void console.log('Not a browser, form submit url: '+e);var a=document.createElement('form');a.setAttribute('method',n),a.setAttribute('action',e),a.setAttribute('target','_blank');for(var o in t)if(r.call(t,o)){var i=document.createElement('input');i.setAttribute('type','hidden'),i.setAttribute('name',o),i.setAttribute('value',t[o]),a.appendChild(i)}document.body.appendChild(a),a.submit()},formSubmit:function(e,n,t){if('undefined'==typeof window)return void console.log('Not a browser, form submit url: '+e);var a=document.createElement('form');a.setAttribute('method',n),a.setAttribute('action',e);for(var o in t)if(r.call(t,o)){var i=document.createElement('input');i.setAttribute('type','hidden'),i.setAttribute('name',o),i.setAttribute('value',t[o]),a.appendChild(i)}document.body.appendChild(a),a.submit()},randomString:function(e){'undefined'==typeof e&&(e=32);for(var n='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789',t=n.length,r='',a=0;a<e;a++)r+=n.charAt(Math.floor(Math.random()*t));return r},redirectTo:function(e){return'undefined'==typeof window?void console.log('Not a browser, redirect url: '+e):void(window.location.href=e)},documentReady:function(e){return'undefined'==typeof document?void e():void('loading'!=document.readyState?e():document.addEventListener('DOMContentLoaded',e))}}},{}]},{},[9])(9)});
//# sourceMappingURL=paymentjs.js.map
